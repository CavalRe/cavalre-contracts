# CavalRe Contracts

This repository contains the core smart contracts powering [CavalRe](https://caval.re), a modular, accounting-driven architecture for onchain capital markets. Contracts are organized into clearly separated modules, libraries, utilities, and illustrative examples.

## Repository Structure

```txt
cavalre-contracts/
├── modules/
│   ├── Module.sol
│   ├── Router.sol
│   └── Ledger.sol
├── libraries/
│   ├── FloatLib.sol
│   ├── FloatStrings.sol
│   ├── LedgerLib.sol
│   ├── ModuleLib.sol
│   ├── RandomLib.sol
│   ├── RouterLib.sol
│   └── TreeLib.sol
├── utilities/
│   ├── Initializable.sol
│   └── ReentrancyGuard.sol
├── interfaces/
│   └── ILedger.sol
├── examples/
│   ├── ERC20.sol
│   ├── ERC4626.sol
│   ├── Sentry.sol
│   └── Token.sol
├── tests/
│   ├── modules/
│   ├── libraries/
│   └── examples/
└── docs/
    └── api/               # generated by forge doc
```

## Core Concepts

- **Module.sol**: Abstract base contract that all modules inherit, defining the shared interface and access to storage.
- **Router.sol**: The immutable entrypoint that delegates calls to upgradeable modules via `delegatecall`.
- **Ledger.sol**: A hierarchical double-entry accounting system where all token balances live under structured subaccounts.
- **FloatLib.sol**: A custom fixed-point math library for precision arithmetic with dynamic scaling.

## Installation

To use CavalRe contracts in your project via Git:

```bash
npm install https://github.com/CavalRe/cavalre-contracts.git
```

Then add this to your `remappings.txt`:

```txt
@cavalre/=node_modules/cavalre-contracts/
```

This allows you to import contracts like:

```solidity
import {Module} from "@cavalre/modules/Module.sol";
import {Ledger} from "@cavalre/modules/Ledger.sol";
```

## Philosophy

CavalRe's smart contracts are built with the following principles:

- **Accounting-first architecture** — balances are structured and provable
- **Modular and upgradeable** — contracts are composed through the Router and can be swapped as independent modules
- **Auditable separation of concerns** — no monolithic contracts, everything is isolated and testable

## Development

Build/test/docs:

```bash
forge build
forge test
forge doc
```

Documentation:

- [Docs Index](docs/README.md)

## License

MIT
